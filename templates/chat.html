{% extends "layout.html" %}

{% block title %}
    Chat
{% endblock %}

{% block navigation %}
    {% if role == "admin" %}
    {% endif %}
{% endblock %}

{% block main %}
    <div id="c01">
        <div id="c02">
            <div id="c03"></div>
            <div>
                <input id="text" name="text" placeholder="Say something..." type="text">
                <button onclick="send()">Send</button>
            </div>
        </div>
        <div id="c02">
            <div>
                <input id="create" name="create" placeholder="Create a room" type="text">
                <button onclick="create()">Create</button>
            </div>
            <div>  
                <ul id="list">
                    <li>Main</li>   <button id="Main">Leave</button>
                </ul>
            </div>
        </div>
    </div>

    <form action="/chat" method="post">
    </form>
    <br>
    <div>
        <a href="/">Index</a>
    </div>

    <style>
        #c01 {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: flex-start;
        }

        #c02 {
            margin-left: 10px;
            margin-right: 10px; 
        }

        #c03 {
            width: 500px;
            height: 250px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            border: 1px solid black;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <script type="text/javascript" charset="utf-8">

        var socket = io();

        // Receive the chat from server
        socket.on("chat", (data) => {

            document.getElementById("c03").innerHTML += "<br>" + "<div style=\"display:inline; white-space:nowrap; align-items:flex-end;\"><img src=\"" + data[3] + "\" alt=\"Profile picture of " + data[2] + "\" height=\"17\" width=\"17\"> " + data[2] + ": " + data[0] + "</div>";
        });

        // Receive the notification from server
        socket.on("notification", (data) => {

            document.getElementById("chat").innerHTML += "<br>" + "<div style=\"display:inline; white-space:nowrap; align-items:flex-end; color:grey;\"><img src=\"" + data[3] + "\" alt=\"Profile picture of " + data[2] + "\" height=\"17\" width=\"17\"> " + data[2] + data[0] + "</div>";
        });


        // Constitute the room list
        function rooms() {

            let target = document.getElementById("list").getElementsByTagName('li');
            let list = [];

            for (let a = 0; a < target.length; a++) {

                list.push(list.item(a).nodeValue)
            };

            return list;
        }

        // Send chat and rooms list to server
        function send() {

            list = rooms()

            return socket.emit("chat", [document.getElementById("text").value, list, "{{ name }}", "{{ picture }}"]);
        };

        // Create a room
        function create() {


        };

        // Join existing room
        function join() {


        };

        // Leave existing room
        function leave() {

            
        };

    
    </script>
{% endblock %}